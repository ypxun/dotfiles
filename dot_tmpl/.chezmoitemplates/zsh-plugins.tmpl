{{- /* 1. è·¯å¾„å¼•ç”¨ (ç”± .chezmoi.toml ç»Ÿä¸€è®¡ç®—) */ -}}
{{- $antidotePath := .path_antidote -}}

{{- /* 2. Linux è‡ªåŠ¨å®‰è£… (macOS é€šå¸¸ç”± Brew å®‰è£…) */ -}}
{{- if (hasPrefix "linux" .osid) }}
# ç¡®ä¿å®‰è£…ç›®å½•å­˜åœ¨
if [ ! -f {{ $antidotePath | quote }} ]; then
    echo "ğŸš€ [Linux] æ­£åœ¨å…‹éš† Antidote..."
    git clone --depth=1 https://github.com/mattmc3/antidote.git "$HOME/.antidote"
fi
{{ end }}

{{- /* 3. æ‰§è¡Œé™æ€ç¼–è¯‘ */ -}}
# ç›‘æ§æ¸…å•å˜åŒ– (ä¸¥æ ¼ä½¿ç”¨ workingTree): 
# {{ include (joinPath .chezmoi.workingTree "zsh/zsh_plugins.txt") | sha256sum }}

if [ -f {{ $antidotePath | quote }} ]; then
    echo "âš¡ æ­£åœ¨ç”Ÿæˆé™æ€æ’ä»¶ç¼“å­˜..."
    # ä½¿ç”¨ zsh æ‰§è¡Œ bundleï¼Œç”Ÿæˆ .zsh_plugins.zsh
    zsh -c "source {{ $antidotePath | quote }} && antidote bundle < $HOME/.zsh_plugins.txt > $HOME/.zsh_plugins.zsh"
else
    echo "âŒ æ‰¾ä¸åˆ° Antidote å…¥å£: {{ $antidotePath }}"
    exit 1
fi