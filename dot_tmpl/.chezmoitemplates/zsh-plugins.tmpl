{{- $antidotePath := "" -}}
{{- if eq .chezmoi.os "darwin" -}}
    {{- /* macOS åˆ†æ”¯ï¼šåŒºåˆ† Apple Silicon å’Œ Intel */ -}}
    {{- if eq .chezmoi.arch "arm64" -}}
        {{- /* M èŠ¯ç‰‡ Mac è·¯å¾„ */ -}}
        {{- $antidotePath = "/opt/homebrew/opt/antidote/share/antidote/antidote.zsh" -}}
    {{- else -}}
        {{- /* Intel Mac è·¯å¾„ */ -}}
        {{- $antidotePath = "/usr/local/opt/antidote/share/antidote/antidote.zsh" -}}
    {{- end -}}
{{- else -}}
    {{- /* Linux åˆ†æ”¯ï¼šç»Ÿä¸€ Git Clone è·¯å¾„ */ -}}
    {{- $antidotePath = "$HOME/.antidote/antidote.zsh" -}}
{{- end -}}

{{- /* 2. Linux è‡ªåŠ¨å®‰è£… */ -}}
{{ if eq .chezmoi.os "linux" -}}
if [ ! -d "$HOME/.antidote" ]; then
    echo "ğŸš€ [Linux] æ­£åœ¨å…‹éš† Antidote..."
    git clone --depth=1 https://github.com/mattmc3/antidote.git "$HOME/.antidote"
fi
{{- end }}

{{- /* 3. æ‰§è¡Œé™æ€ç¼–è¯‘ */ -}}
# ç›‘æ§æ¸…å•å˜åŒ– (ä¸¥æ ¼ä½¿ç”¨ workingTree): 
# {{ include (joinPath .chezmoi.workingTree "zsh/zsh_plugins.txt") | sha256sum }}

if [ -f {{ $antidotePath | quote }} ]; then
    echo "âš¡ æ­£åœ¨ç”Ÿæˆé™æ€æ’ä»¶ç¼“å­˜..."
    zsh -c "source {{ $antidotePath }} && antidote bundle < $HOME/.zsh_plugins.txt > $HOME/.zsh_plugins.zsh"
else
    echo "âŒ æ‰¾ä¸åˆ° Antidote å…¥å£: {{ $antidotePath }}"
    exit 1
fi
