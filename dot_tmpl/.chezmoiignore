{{- /* 1. Windows 特有排除 */ -}}
{{- if eq .osid "windows" }}
.zshrc
.p10k.zsh
.vimrc
.config/tmux/
.config/tmux/**
# Windows 不运行 shell 脚本
.chezmoiscripts/**
{{ end }}

{{- /* 2. 跨平台/特定模式排除 */ -}}
# 如果不是“私人、无头、非临时”环境，则排除 authorized_keys
# 这样 Mac、公司电脑、容器环境都不会产生这个文件
{{- if not (and .personal .headless (not .ephemeral)) }}
.ssh/authorized_keys
{{ end }}

{{- /* 2. macOS 独占软件排除 (AeroSpace, Hammerspoon) */ -}}
{{- if ne .osid "darwin" }}
.aerospace.toml
.hammerspoon/
.hammerspoon/**
.Brewfile
{{ end }}

# --- 3. 无头模式过滤 (WSL2/服务器) ---
{{ if .headless -}}
.wezterm.lua
{{- if not .is_wsl }}
.ssh/key_vps_root
.ssh/key_vps_user
{{- end }}
{{- end }}

# --- 4. 隐私隔离墙 (核心优化) ---
# 临时环境：全屏蔽
{{- if .ephemeral }}
.ssh/
.ssh/**
.gnupg/
.gnupg/**
.zshrc.secret
{{ end }}

# 工作环境：只屏蔽个人私钥和个人VPS配置
{{- if .work }}
.ssh/id_rsa
.ssh/id_rsa.pub
.ssh/github_ypxun
.ssh/key_vps_root
.ssh/key_vps_user
.gnupg/
.gnupg/**
.zshrc.secret
{{ end }}

# 非个人且非工作（未知环境）：全屏蔽
{{- if and (not .personal) (not .work) }}
.ssh/
.ssh/**
.gnupg/
.gnupg/**
.zshrc.secret
{{ end }}

# --- 5. 脚本排除 ---
# 如果 osid 不以 "linux" 开头 (例如 windows, darwin)，则排除 linux 脚本
{{- if not (hasPrefix "linux" .osid) }}
.chezmoiscripts/linux/**
pbcopy.py
{{ end }}

# 如果 osid 不是 "darwin"，则排除 darwin 脚本
{{- if ne .osid "darwin" }}
.chezmoiscripts/darwin/**
{{ end }}
