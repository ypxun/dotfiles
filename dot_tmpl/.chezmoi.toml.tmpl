{{- /* 1. 环境初始化 */ -}}
{{- $ephemeral := false -}}
{{- $headless := false -}}
{{- $personal := false -}}
{{- $work := false -}}

{{- /* 2. 操作系统与主机名探测 */ -}}
{{- $osID := .chezmoi.os -}}
{{- if hasKey .chezmoi.osRelease "id" -}}
    {{- $osID = .chezmoi.osRelease.id -}} {{/* 直接用 debian, ubuntu, arch 等，不加 linux- 前缀 */}}
{{- end -}}

{{- $hostname := .chezmoi.hostname -}}
{{- if eq .chezmoi.os "darwin" -}}
    {{- $hostname = output "scutil" "--get" "LocalHostName" | trim -}}
{{- end -}}

{{- /* 3. 自动识别临时环境 (Codespaces, Docker, 等) */ -}}
{{- if or (env "CODESPACES") (env "REMOTE_CONTAINERS_IPC") (eq .chezmoi.username "ubuntu" "vscode") -}}
    {{- $ephemeral = true -}}
    {{- $headless = true -}}
{{- end -}}

{{- /* 4. 身份核心逻辑：基于主机名的全自动识别 */ -}}
{{- if not $ephemeral -}}
    {{- if eq $hostname "pkmbp" "pk-pc" -}}
        {{- $personal = true -}}
        {{- $headless = false -}}
    {{- else if eq $hostname "debian" -}}{{/* 这里填你 VPS 的主机名 */}}
        {{- $personal = true -}}
        {{- $headless = true -}}
    {{- else if stdinIsATTY -}}
        {{- $personal = promptBoolOnce . "personal" "是否为个人设备?" -}}
        {{- $headless = promptBoolOnce . "headless" "是否为无头(服务器)模式?" -}}
    {{- else -}}
        {{- $ephemeral = true -}}
    {{- end -}}
{{- end -}}

{{- /* 5. 变量获取 */ -}}
{{- $email := promptStringOnce . "email" "Git Email Address" -}}
{{- $name := promptStringOnce . "name" "Git User Name" -}}

[data]
    email = {{ $email | quote }}
    name = {{ $name | quote }}
    personal = {{ $personal }}
    headless = {{ $headless }}
    ephemeral = {{ $ephemeral }}
    osid = {{ $osID | quote }}
    hostname = {{ $hostname | quote }}
    vps_items = ["vps_kr_oracle", "vps_jp_claw", "vps_sg_mikyhost"] 
# --- 以下为你原有的全局配置 ---

ignorePatterns = [
  "*.secret", "*.key", "*.pem", "*.token",
  "*.swp", "*.un~", "*~",
  ".DS_Store", "Thumbs.db",
  ".git", ".gitignore",
  "node_modules", "venv", ".venv"
]

[edit]
    command = "code"
    args = ["--wait"]

[diff]
    command = "delta"

[git]
    autoCommit = true
    autoPush = false

[cd]
    command = {{ if eq .chezmoi.os "windows" }}"pwsh"{{ else }}"zsh"{{ end }}

[apply]
    refreshPeriod = "1m"
    