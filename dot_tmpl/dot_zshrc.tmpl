# --- 1. 第一优先级：P10K Instant Prompt ---
if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
  source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
fi

# --- 2. 第二优先级：Chezmoi 注入环境变量 ---
export MAMBA_EXE={{ .mamba_exe | quote }}
# 让 FZF 默认使用 fd (提速 + 忽略 .git/node_modules)
# 放在这里，确保后续加载插件时该变量已存在
export FZF_DEFAULT_COMMAND='fd --type f'

{{ if eq .chezmoi.os "darwin" -}}
{{- $brew_exe := "/usr/local/bin/brew" }}{{ if eq .chezmoi.arch "arm64" }}{{ $brew_exe = "/opt/homebrew/bin/brew" }}{{ end -}}
[[ -f {{ $brew_exe | quote }} ]] && eval "$({{ $brew_exe }} shellenv)"
{{- end }}

# --- 3. 第三优先级：引入原始 zshrc 主体 ---
{{ include (joinPath .chezmoi.workingTree "zsh/zshrc") }}

# --- 4. 最终补丁：抹平跨平台命令名差异 ---

# 1. 差异化适配
{{ if (or (eq .osid "debian") (eq .osid "ubuntu")) -}}
alias fd='fdfind'
alias bat='batcat'
{{- end }}

# 2. 现代工具别名 
alias cat='bat -P'
